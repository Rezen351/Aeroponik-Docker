<template>
    <svg
        @click="send"
        viewBox="137 29 221 311"
        xmlns="http://www.w3.org/2000/svg"
    >
        <defs>
            <linearGradient
                id="gradient-0"
                gradientUnits="userSpaceOnUse"
                x1="246.886"
                y1="49.957"
                x2="246.886"
                y2="113.253"
                gradientTransform="matrix(0.306291, 0, 0, 0.306291, 171.267055, 78.564631)"
            >
                <stop
                    offset="0"
                    style="stop-color: rgb(100% 100% 100%)"
                />
                <stop
                    offset="1"
                    style="stop-color: rgb(210, 202, 202);"
                />
            </linearGradient>
        </defs>
        <path
            d="M 140.937 33.125 L 354.687 33.125 L 354.687 224.128 C 354.762 225.771 354.8 227.425 354.8 229.087 C 354.8 288.126 306.939 335.987 247.9 335.987 C 188.957 335.987 141.156 288.282 141 229.375 L 140.937 229.375 L 140.937 33.125 Z"
            style="stroke: rgb(0, 0, 0); fill: rgb(40, 40, 40);"
        >
            <title>Label_Holder</title>
        </path>
        <rect
            x="156.102"
            y="49.957"
            width="181.568"
            height="63.296"
            style="stroke: rgb(0, 0, 0); fill: url('#gradient-0');"
        >
            <title>Label</title>
        </rect>
        <text
            style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px; text-anchor: middle;"
            x="247.869"
            y="91.061"
        ><title>Label_Text</title>{{ props.label }}
        </text>
        <ellipse
            style="fill: rgb(197, 200, 197);"
            cx="246.937"
            cy="227.812"
            rx="97.812"
            ry="97.812"
        >
            <title>Ring_Ouline</title>
        </ellipse>
        <ellipse
            style="fill: rgb(213, 216, 216);"
            cx="246.5"
            cy="228.375"
            rx="89.062"
            ry="89.062"
        >
            <title>Ring_Highlight_Middle</title>
        </ellipse>
        <ellipse
            style="fill: rgb(243, 243, 243);"
            cx="246.625"
            cy="228.375"
            rx="83.437"
            ry="83.437"
        >
            <title>Ring_Highlight_Inner</title>
        </ellipse>
        <ellipse
            style="fill: rgb(168, 168, 168);"
            cx="246.912"
            cy="227.662"
            rx="78.554"
            ry="78.554"
        >
            <title>Ring_Inner_Gap</title>
        </ellipse>
        <ellipse
            :class="`hmi-color-${props.hmiColor??'red'}`"
            cx="247.093"
            cy="227.482"
            rx="76.203"
            ry="76.203"
        >
            <title>Button_Lens</title>
        </ellipse>
        <ellipse
            style="fill: none; stroke: rgb(0, 0, 0); stroke-opacity: 0.24; stroke-width: 2px;"
            cx="247.273"
            cy="227.3"
            rx="74.937"
            ry="74.937"
        >
            <title>Button_Lens_Shadow</title>
        </ellipse>
        <ellipse
            v-if="props.hmiSymbol === 'symbol_O'"
            style="fill: none; stroke: rgb(243, 243, 243); stroke-width: 15px; stroke-opacity: 0.72;"
            cx="247.369"
            cy="226.561"
            rx="43.5"
            ry="43.5"
        >
            <title>Symbol_O</title>
        </ellipse>
        <path
            v-if="props.hmiSymbol === 'symbol_I'"
            d="M 240.5 184.344 L 240.602 184.344 C 240.535 183.94 240.5 183.526 240.5 183.103 C 240.5 178.961 243.858 175.603 248 175.603 C 252.142 175.603 255.5 178.961 255.5 183.103 C 255.5 183.526 255.465 183.94 255.398 184.344 L 255.5 184.344 L 255.5 270.412 L 255.451 270.412 C 255.186 274.314 251.937 277.397 247.968 277.397 C 243.826 277.397 240.468 274.039 240.468 269.897 C 240.468 269.662 240.479 269.429 240.5 269.2 Z"
            style="fill: rgb(243, 243, 243); fill-opacity: 0.72;"
        >
            <title>Symbol_I</title>
        </path>
    </svg>
</template>

<script>
import { mapState } from 'vuex'

export default {
    name: 'HmiPushButton',
    inject: ['$socket'],
    props: {
        /* do not remove entries from this - Dashboard's Layout Manager's will pass this data to your component */
        id: {
            type: String,
            required: true
        },
        props: {
            type: Object,
            default: () => ({})
        },
        state: {
            type: Object,
            default: () => ({
                enabled: false,
                visible: false
            })
        }
    },
    setup (props) {
        console.debug('HmiPushButton setup with:', JSON.parse(JSON.stringify(props)))
    },
    computed: {
        ...mapState('data', ['messages']),
        mdIcon () {
            if (this.props?.icon === undefined) {
                return undefined
            }
            return 'mdi-' + this.props.icon.replace(/^mdi-/, '')
        }
    },
    mounted () {
        this.$socket.on('widget-load:' + this.id, (msg) => {
            // load the latest message from the Node-RED datastore when this widget is loaded
            // storing it in our vuex store so that we have it saved as we navigate around
            this.$store.commit('data/bind', {
                widgetId: this.id,
                msg
            })
        })
        this.$socket.on('msg-input:' + this.id, (msg) => {
            // store the latest message in our client-side vuex store when we receive a new message
            this.$store.commit('data/bind', {
                widgetId: this.id,
                msg
            })
        })
        // tell Node-RED that we're loading a new instance of this widget
        this.$socket.emit('widget-load', this.id)
    },
    unmounted () {
        /* Make sure, any events you subscribe to on SocketIO are unsubscribed to here */
        this.$socket?.off('widget-load' + this.id)
        this.$socket?.off('msg-input:' + this.id)
    },
    methods: {
        /*
            widget-action just sends a msg to Node-RED, it does not store the msg state server-side
            alternatively, you can use widget-change, which will also store the msg in the Node's datastore
        */
        send (msg) {
            this.$socket.emit('widget-action', this.id, msg)
        }
    }
}
</script>

<style scoped>
.hmi-color-red {
    fill: red;
}

.hmi-color-orange {
    fill: #F60;
}

.hmi-color-green {
    fill: green;
}

/* CSS is auto scoped, but using named classes is still recommended */
</style>
